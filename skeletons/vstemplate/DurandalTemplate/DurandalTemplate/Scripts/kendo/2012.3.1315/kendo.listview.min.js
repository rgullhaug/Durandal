/*
* Kendo UI Web v2012.3.1413 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-web-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
(function(e,t){var a=window.kendo,r="change",n="dataBound",i="dataBinding",l=a.ui.Widget,o=a.keys,s=">*",d="progress",c="error",u="k-state-focused",m="k-state-selected",f="k-edit-item",p="string",v="edit",g="remove",h="save",b="click",_=".kendoListView",S=e.proxy,E=a.ui.progress,y=a.data.DataSource,w=l.extend({init:function(t,r){var n=this;r=e.isArray(r)?{dataSource:r}:r,l.fn.init.call(n,t,r),r=n.options,n.wrapper=t=n.element,t[0].id&&(n._itemId=t[0].id+"_lv_active"),n._element(),n._dataSource(),n.template=a.template(r.template||""),n.altTemplate=a.template(r.altTemplate||r.template),n.editTemplate=a.template(r.editTemplate||""),n._navigatable(),n._selectable(),n._pageable(),n._crudHandlers(),n.options.autoBind&&n.dataSource.fetch(),a.notify(n)},events:[r,i,n,v,g,h],options:{name:"ListView",autoBind:!0,selectable:!1,navigatable:!1,template:"",altTemplate:"",editTemplate:""},_item:function(e){return this.element.children()[e]()},items:function(){return this.element.children()},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&e.fetch()},_unbindDataSource:function(){var e=this;e.dataSource.unbind(r,e._refreshHandler).unbind(d,e._progressHandler).unbind(c,e._errorHandler)},_dataSource:function(){var e=this;e.dataSource&&e._refreshHandler?e._unbindDataSource():(e._refreshHandler=S(e.refresh,e),e._progressHandler=S(e._progress,e),e._errorHandler=S(e._error,e)),e.dataSource=y.create(e.options.dataSource).bind(r,e._refreshHandler).bind(d,e._progressHandler).bind(c,e._errorHandler)},_progress:function(){E(this.element,!0)},_error:function(){E(this.element,!1)},_element:function(){this.element.addClass("k-widget k-listview").attr("role","listbox")},refresh:function(r){var l,o,s,d,c,u,m=this,f=m.dataSource.view(),p="",v=m.template,g=m.altTemplate;if(r&&"itemchange"===r.action)return m.editable||(l=r.items[0],d=e.inArray(l,f),d>=0&&(m.items().eq(d).replaceWith(v(l)),s=m.items().eq(d),s.attr(a.attr("uid"),l.uid),m.trigger("itemChange",{item:s,data:l}))),t;if(r=r||{},!m.trigger(i,{action:r.action||"rebind",items:r.items,index:r.index})){for(m._destroyEditable(),d=0,c=f.length;c>d;d++)p+=d%2?g(f[d]):v(f[d]);for(m.element.html(p),o=m.items(),d=0,c=f.length;c>d;d++)o.eq(d).attr(a.attr("uid"),f[d].uid).attr("role","option").attr("aria-selected","false");try{u=document.activeElement}catch(h){}m.element[0]===u&&m.options.navigatable&&m.current(o.eq(0)),m.trigger(n)}},_pageable:function(){var t,r,n=this,i=n.options.pageable;e.isPlainObject(i)&&(r=i.pagerId,t=e.extend({},i,{dataSource:n.dataSource,pagerId:null}),n.pager=new a.ui.Pager(e("#"+r),t))},_selectable:function(){var e,n,i=this,l=i.options.selectable,d=i.options.navigatable;l&&(e=typeof l===p&&l.toLowerCase().indexOf("multiple")>-1,e&&i.element.attr("aria-multiselectable",!0),i.selectable=new a.ui.Selectable(i.element,{aria:!0,multiple:e,filter:s,change:function(){i.trigger(r)}}),d&&i.element.on("keydown"+_,function(a){if(a.keyCode===o.SPACEBAR){if(n=i.current(),a.target==a.currentTarget&&a.preventDefault(),e)if(a.ctrlKey){if(n&&n.hasClass(m))return n.removeClass(m),t}else i.selectable.clear();else i.selectable.clear();i.selectable.value(n)}}))},current:function(e){var a=this,r=a.element,n=a._current,i=a._itemId;return e===t?n:(n&&(n[0].id===i&&n.removeAttr("id"),n.removeClass(u),r.removeAttr("aria-activedescendant")),e&&e[0]&&(i=e[0].id||i,a._scrollTo(e[0]),r.attr("aria-activedescendant",i),e.addClass(u).attr("id",i)),a._current=e,t)},_scrollTo:function(t){var a,r=this,n=!1,i="scroll";"auto"==r.wrapper.css("overflow")||r.wrapper.css("overflow")==i?a=r.wrapper[0]:(a=window,n=!0);var l=function(r,l){var o=n?e(t).offset()[r.toLowerCase()]:t["offset"+r],s=t["client"+l],d=e(a)[i+r](),c=e(a)[l.toLowerCase()]();o+s>d+c?e(a)[i+r](o+s-c):d>o&&e(a)[i+r](o)};l("Top","Height"),l("Left","Width")},_navigatable:function(){var t=this,r=t.options.navigatable,n=t.element,i=function(a){t.current(e(a.currentTarget)),e(a.target).is(":button,a,:input,a>.k-icon,textarea")||n.focus()};r&&(t._tabindex(),n.on("focus"+_,function(){var e=t._current;e&&e.is(":visible")||(e=t._item("first")),t.current(e)}).on("focusout"+_,function(){t._current&&t._current.removeClass(u)}).on("keydown"+_,function(r){var i,l,s=r.keyCode,d=t.current(),c=e(r.target),u=!c.is(":button,textarea,a,a>.t-icon,input"),m=c.is(":text"),p=a.preventDefault,v=n.find("."+f);if(!(!u&&!m&&o.ESC!=s||m&&o.ESC!=s&&o.ENTER!=s))if(o.UP===s||o.LEFT===s)d&&(d=d.prev()),t.current(d&&d[0]?d:t._item("last")),p(r);else if(o.DOWN===s||o.RIGHT===s)d&&(d=d.next()),t.current(d&&d[0]?d:t._item("first")),p(r);else if(o.PAGEUP===s)t.current(null),t.dataSource.page(t.dataSource.page()-1),p(r);else if(o.PAGEDOWN===s)t.current(null),t.dataSource.page(t.dataSource.page()+1),p(r);else if(o.HOME===s)t.current(t._item("first")),p(r);else if(o.END===s)t.current(t._item("last")),p(r);else if(o.ENTER===s)if(0!==v.length&&(u||m)){i=t.items().index(v);try{l=document.activeElement}catch(g){}l&&l.blur(),t.save();var h=function(){t.element.trigger("focus"),t.current(t.items().eq(i))};t.one("dataBound",h)}else""!==t.options.editTemplate&&t.edit(d);else if(o.ESC===s){if(v=n.find("."+f),0===v.length)return;i=t.items().index(v),t.cancel(),t.element.trigger("focus"),t.current(t.items().eq(i))}}),n.on("mousedown"+_+" touchstart"+_,s,S(i,t)))},clearSelection:function(){var e=this;e.selectable.clear(),e.trigger(r)},select:function(a){var r=this,n=r.selectable;return a=e(a),a.length?(n.options.multiple||(n.clear(),a=a.first()),n.value(a),t):n.value()},_destroyEditable:function(){var e=this;e.editable&&(e.editable.destroy(),delete e.editable)},_modelFromElement:function(e){var t=e.attr(a.attr("uid"));return this.dataSource.getByUid(t)},_closeEditable:function(e){var t,r,n=this,i=n.editable,l=n.template,o=!0;return i&&(e&&(o=i.end()),o&&(i.element.index()%2&&(l=n.altTemplate),t=n._modelFromElement(i.element),n._destroyEditable(),r=i.element.index(),i.element.replaceWith(l(t)),n.items().eq(r).attr(a.attr("uid"),t.uid))),o},edit:function(e){var t,r=this,n=r._modelFromElement(e),i=e.index();r.cancel(),e.replaceWith(r.editTemplate(n)),t=r.items().eq(i).addClass(f).attr(a.attr("uid"),n.uid),r.editable=t.kendoEditable({model:n,clearContainer:!1,errorTemplate:!1}).data("kendoEditable"),r.trigger(v,{model:n,item:t})},save:function(){var e,t=this,a=t.editable;a&&(a=a.element,e=t._modelFromElement(a),!t.trigger(h,{model:e,item:a})&&t._closeEditable(!0)&&t.dataSource.sync())},remove:function(e){var t=this,a=t.dataSource,r=t._modelFromElement(e);t.trigger(g,{model:r,item:e})||(e.hide(),a.remove(r),a.sync())},add:function(){var e=this,t=e.dataSource,a=t.indexOf((t.view()||[])[0]);0>a&&(a=0),e.cancel(),t.insert(a,{}),e.edit(e.element.children().first())},cancel:function(){var e=this,t=e.dataSource;e.editable&&(t.cancelChanges(e._modelFromElement(e.editable.element)),e._closeEditable(!1))},_crudHandlers:function(){var t=this,r=b+_;t.element.on(r,".k-edit-button",function(r){var n=e(this).closest("["+a.attr("uid")+"]");t.edit(n),r.preventDefault()}),t.element.on(r,".k-delete-button",function(r){var n=e(this).closest("["+a.attr("uid")+"]");t.remove(n),r.preventDefault()}),t.element.on(r,".k-update-button",function(e){t.save(),e.preventDefault()}),t.element.on(r,".k-cancel-button",function(e){t.cancel(),e.preventDefault()})},destroy:function(){var e=this;l.fn.destroy.call(e),e._unbindDataSource(),e._destroyEditable(),e.element.off(_),e.pager&&e.pager.destroy(),e.selectable&&e.selectable.destroy(),a.destroy(e.element)}});a.ui.plugin(w)})(window.kendo.jQuery);